<!-- templates/projects_itam_ciid.html - ITAM CIID Projects Listing -->
{% extends "base.html" %}

{% block title %}Dotsh - ITAM CIID Projects{% endblock %}

{% block content %}
<style>
    .search-box {
        display: flex;
        gap: 12px;
        margin-bottom: 30px;
    }
    .search-input {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 15px;
        outline: none;
    }
    .search-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .search-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
        margin-bottom: 30px;
    }
    .project-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
        text-decoration: none;
        color: inherit;
        display: block;
    }
    .project-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        border-color: #667eea;
    }
    .project-header {
        display: flex;
        align-items: start;
        justify-content: space-between;
        margin-bottom: 16px;
    }
    .project-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }
    .project-name {
        font-size: 20px;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 4px;
    }
    .project-ciid {
        font-size: 12px;
        color: #667eea;
        font-weight: 600;
        background: #eef2ff;
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-block;
        margin-bottom: 8px;
    }
    .project-description {
        font-size: 14px;
        color: #718096;
        margin-bottom: 16px;
        line-height: 1.5;
        min-height: 42px;
    }
    .project-meta {
        font-size: 13px;
        color: #718096;
        margin-bottom: 16px;
        padding: 12px;
        background: #f7fafc;
        border-radius: 6px;
    }
    .project-meta-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
    }
    .project-meta-item:last-child {
        margin-bottom: 0;
    }
    .env-badges {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 16px;
    }
    .env-badge {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
    }
    .env-badge.stage {
        background: #fef3c7;
        color: #92400e;
    }
    .env-badge.prod {
        background: #d1fae5;
        color: #065f46;
    }
    .view-details {
        margin-top: 16px;
        padding: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-align: center;
        border-radius: 6px;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s;
    }
    .project-card:hover .view-details {
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }
    .stats-row {
        display: flex;
        gap: 16px;
        justify-content: space-between;
        padding-top: 12px;
        border-top: 1px solid #e2e8f0;
    }
    .stat-item {
        text-align: center;
        flex: 1;
    }
    .stat-value {
        font-size: 20px;
        font-weight: bold;
        color: #2d3748;
    }
    .stat-label {
        font-size: 11px;
        color: #718096;
        text-transform: uppercase;
        margin-top: 4px;
    }
    .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 60px;
        color: #718096;
    }
    .empty-state svg {
        width: 64px;
        height: 64px;
        margin: 0 auto 20px;
        opacity: 0.3;
    }
    .empty-state h3 {
        margin-bottom: 8px;
        color: #2d3748;
    }
    .page-header-actions {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
    }
    .action-btn {
        padding: 10px 20px;
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        color: #4a5568;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
    }
    .action-btn:hover {
        border-color: #667eea;
        color: #667eea;
    }
    .action-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
    }
</style>

<div class="dashboard">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="logo" onclick="location.href='{{ url_for('dashboard') }}'">
            dotsh<span class="logo-dot">.</span>
        </div>
        
        <div class="nav-menu">
            <a href="{{ url_for('dashboard') }}" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="7" height="7" rx="1" stroke-width="2"/>
                    <rect x="14" y="3" width="7" height="7" rx="1" stroke-width="2"/>
                    <rect x="14" y="14" width="7" height="7" rx="1" stroke-width="2"/>
                    <rect x="3" y="14" width="7" height="7" rx="1" stroke-width="2"/>
                </svg>
                <span class="tooltip">Overview</span>
            </a>

            <a href="{{ url_for('capacity') }}" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="3" width="20" height="5" rx="1" stroke-width="2"/>
                    <rect x="2" y="10" width="20" height="5" rx="1" stroke-width="2"/>
                    <rect x="2" y="17" width="20" height="5" rx="1" stroke-width="2"/>
                </svg>
                <span class="tooltip">Server Capacity</span>
            </a>

            <a href="{{ url_for('projects') }}" class="nav-item active">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" stroke-width="2"/>
                </svg>
                <span class="tooltip">Project Servers</span>
            </a>

            <a href="{{ url_for('alerts') }}" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" stroke-width="2"/>
                </svg>
                <span class="tooltip">Alerts</span>
            </a>

            <a href="{{ url_for('logout') }}" class="nav-item nav-logout" onclick="return confirm('Are you sure you want to logout?')">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke-width="2"/>
                    <polyline points="16 17 21 12 16 7" stroke-width="2"/>
                    <line x1="21" y1="12" x2="9" y2="12" stroke-width="2"/>
                </svg>
                <span class="tooltip">Logout</span>
            </a>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="header">
            <h1>ITAM CIID Projects</h1>
            <p>View and manage projects organized by ITAM CIID</p>
        </div>

        <!-- View Toggle -->
        <div class="page-header-actions">
            <a href="{{ url_for('projects') }}" class="action-btn">
                View by LOB
            </a>
            <a href="{{ url_for('projects_itam_ciid') }}" class="action-btn active">
                View by ITAM CIID
            </a>
        </div>

        <!-- Search Box -->
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="Search by ITAM CIID, LOB, or owner..." onkeyup="searchProjects()">
            <button class="search-btn" onclick="searchProjects()">
                <svg style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 8px;" viewBox="0 0 24 24" fill="none">
                    <circle cx="11" cy="11" r="8" stroke="white" stroke-width="2"/>
                    <path d="M21 21l-4.35-4.35" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Search
            </button>
        </div>

        <!-- Projects Grid -->
        <div class="projects-grid" id="projectsGrid">
            {% if projects %}
                {% for project in projects %}
                <a href="{{ url_for('project_detail_itam_ciid', project_id=project.id) }}" class="project-card" 
                   data-name="{{ project.name|lower }}" 
                   data-owner="{{ project.owner|lower }}"
                   data-lob="{{ project.lob|lower }}">
                    <div class="project-header">
                        <div>
                            <div class="project-ciid">ITAM CIID: {{ project.name }}</div>
                            <div class="project-name">{{ project.lob }}</div>
                        </div>
                        <div class="project-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="project-description">
                        {{ project.description or 'No description available' }}
                    </div>
                    
                    <div class="project-meta">
                        <div class="project-meta-item">
                            <span><strong>Owner:</strong></span>
                            <span>{{ project.owner }}</span>
                        </div>
                        <div class="project-meta-item">
                            <span><strong>LOB:</strong></span>
                            <span>{{ project.lob }}</span>
                        </div>
                        <div class="project-meta-item">
                            <span><strong>Created:</strong></span>
                            <span>{{ project.created_at.strftime('%b %d, %Y') if project.created_at else 'N/A' }}</span>
                        </div>
                    </div>
                    
                    <div class="env-badges">
                        {% if project.has_prod %}
                        <span class="env-badge prod">
                            PRODUCTION ({{ project.prod_count }})
                        </span>
                        {% endif %}
                        {% if project.has_stage %}
                        <span class="env-badge stage">
                            STAGING ({{ project.stage_count }})
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="stats-row">
                        <div class="stat-item">
                            <div class="stat-value">
                                {% if project.has_prod and project.has_stage %}
                                2
                                {% elif project.has_prod or project.has_stage %}
                                1
                                {% else %}
                                0
                                {% endif %}
                            </div>
                            <div class="stat-label">Environments</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ project.total_count }}</div>
                            <div class="stat-label">Total Servers</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">
                                {% if project.has_prod %}{{ project.prod_count }}{% else %}0{% endif %}
                            </div>
                            <div class="stat-label">Prod Servers</div>
                        </div>
                    </div>
                    
                    <div class="view-details">
                        View Project Details â†’
                    </div>
                </a>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <h3>No ITAM CIID Projects Found</h3>
                    <p>No ITAM CIID data available in the inventory</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function searchProjects() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const cards = document.querySelectorAll('.project-card');
    
    cards.forEach(card => {
        const name = card.getAttribute('data-name') || '';
        const owner = card.getAttribute('data-owner') || '';
        const lob = card.getAttribute('data-lob') || '';
        
        if (name.includes(input) || owner.includes(input) || lob.includes(input)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

// Allow search on Enter key
document.getElementById('searchInput').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
        searchProjects();
    }
});
</script>
{% endblock %}