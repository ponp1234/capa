<!-- templates/dashboard.html -->
{% extends "base.html" %}

{% block title %}Dotsh - Dashboard{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="logo" onclick="location.href='{{ url_for('dashboard') }}'">
            dotsh<span class="logo-dot">.</span>
        </div>
        
        <div class="nav-menu">
            <!-- Overview -->
            <a href="{{ url_for('dashboard') }}" class="nav-item active">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="7" height="7" rx="1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <rect x="14" y="3" width="7" height="7" rx="1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <rect x="14" y="14" width="7" height="7" rx="1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <rect x="3" y="14" width="7" height="7" rx="1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="tooltip">Overview</span>
            </a>

            <!-- Server Capacity -->
            <a href="{{ url_for('capacity') }}" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="3" width="20" height="5" rx="1" stroke-width="2"/>
                    <rect x="2" y="10" width="20" height="5" rx="1" stroke-width="2"/>
                    <rect x="2" y="17" width="20" height="5" rx="1" stroke-width="2"/>
                </svg>
                <span class="tooltip">Server Capacity</span>
            </a>

            <!-- Project Servers -->
            <a href="{{ url_for('projects') }}" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="tooltip">Project Servers</span>
            </a>

            <!-- Alerts -->
            <a href="{{ url_for('alerts') }}" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="tooltip">Alerts</span>
            </a>

            <!-- Logout -->
            <a href="{{ url_for('logout') }}" class="nav-item nav-logout" onclick="return confirm('Are you sure you want to logout?')">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="16 17 21 12 16 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="21" y1="12" x2="9" y2="12" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="tooltip">Logout</span>
            </a>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Page Header -->
        <div class="header">
            <h1>Overview Dashboard</h1>
            <p>Monitor your infrastructure in real-time</p>
        </div>

        <!-- Stats Cards Grid -->
        <div class="cards-grid">
            <!-- Total Servers Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon purple">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2" y="3" width="20" height="14" rx="2" stroke-width="2"/>
                            <line x1="8" y1="21" x2="16" y2="21" stroke-width="2" stroke-linecap="round"/>
                            <line x1="12" y1="17" x2="12" y2="21" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="card-title">Total Servers</div>
                </div>
                <div class="card-value">{{ total_servers }}</div>
                <div class="card-change positive">↑ 2 from last week</div>
            </div>

            <!-- Active Projects Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon green">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <polyline points="22 4 12 14.01 9 11.01" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="card-title">Active Projects</div>
                </div>
                <div class="card-value">{{ active_projects }}</div>
                <div class="card-change positive">↑ 3 from last month</div>
            </div>

            <!-- Alerts Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon orange">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke-width="2"/>
                            <line x1="12" y1="8" x2="12" y2="12" stroke-width="2" stroke-linecap="round"/>
                            <line x1="12" y1="16" x2="12.01" y2="16" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="card-title">Alerts</div>
                </div>
                <div class="card-value">{{ active_alerts }}</div>
                <div class="card-change negative">↑ 1 from yesterday</div>
            </div>

            <!-- Average CPU Usage Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon blue">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="card-title">Avg. CPU Usage</div>
                </div>
                <div class="card-value">{{ avg_cpu }}%</div>
                <div class="card-change positive">↓ 5% from last hour</div>
            </div>
        </div>

        <!-- Server Activity Table -->
        <div class="content-section">
            <div class="section-header">
                <h2 class="section-title">Recent Server Activity</h2>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Server Name</th>
                            <th>Status</th>
                            <th>CPU</th>
                            <th>Memory</th>
                            <th>Uptime</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if servers %}
                            {% for server in servers %}
                            <tr>
                                <td><strong>{{ server.name }}</strong></td>
                                <td>
                                    <span class="status-badge {{ server.status }}">
                                        {{ server.status|capitalize }}
                                    </span>
                                </td>
                                <td>{{ server.cpu }}%</td>
                                <td>{{ server.memory }}%</td>
                                <td>{{ server.uptime }}</td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px; color: #718096;">
                                    No servers found. Please add servers to monitor.
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Additional Server Metrics (Optional) -->
        <div class="content-section">
            <div class="section-header">
                <h2 class="section-title">Server Health Status</h2>
            </div>
            
            <div class="cards-grid">
                {% for server in servers[:4] %}
                <div class="card">
                    <h3 style="font-size: 18px; color: #2d3748; margin-bottom: 12px;">
                        {{ server.name }}
                    </h3>
                    <div style="display: flex; gap: 20px; margin-top: 16px;">
                        <div style="flex: 1;">
                            <div style="font-size: 12px; color: #718096; margin-bottom: 4px;">CPU</div>
                            <div style="font-size: 20px; font-weight: bold; color: #2d3748;">
                                {{ server.cpu }}%
                            </div>
                            <div class="progress-bar" style="margin-top: 8px;">
                                <div class="progress-fill {% if server.cpu < 50 %}low{% elif server.cpu < 80 %}medium{% else %}high{% endif %}" 
                                     style="width: {{ server.cpu }}%"></div>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 12px; color: #718096; margin-bottom: 4px;">Memory</div>
                            <div style="font-size: 20px; font-weight: bold; color: #2d3748;">
                                {{ server.memory }}%
                            </div>
                            <div class="progress-bar" style="margin-top: 8px;">
                                <div class="progress-fill {% if server.memory < 50 %}low{% elif server.memory < 80 %}medium{% else %}high{% endif %}" 
                                     style="width: {{ server.memory }}%"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                        <span class="status-badge {{ server.status }}">{{ server.status|capitalize }}</span>
                        <span style="float: right; color: #718096; font-size: 13px;">
                            Uptime: {{ server.uptime }}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}